<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple Markers</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

  
      #idmodalmenu{
z-index: 5;
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20%;
        height: 100%;
     background: #4DD0E1;
      opacity: 0.5;
      }
      #ideliminarm{
     
        position: absolute;
        top: 20%;
        left:10px;
        z-index: 6
      }

          #idbt{  
position: absolute;
top:30%;
 left:10px;
        z-index: 3;
      }
      #idnewpoli{
position: absolute;
           top: 49%;
        left:10px;
        z-index: 7
      }


      #idbarrabaja{
        z-index: 1000;
        position: absolute;
  background: #4DD0E1;
      opacity: 0.3;
      top:90%;
      width: 100%;
      height:10%;
      }
      #idbtmenupoligono{

        z-index: 10001;
          opacity:1; 
           background: #FFFFFF;
      }
      #idbtedita{
        position: absolute;
top:46%;
 left:10px;
        z-index: 3;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    
    <div id="idmodalmenu"><button id="ideliminarm" onclick="fdeletmark()">&#9746;</button><br><button id="idbt" onclick="myFunction()">&#9736;</button>
<br><button id="idbtedita" onclick="feditarpoli()">&#9736;</button><input type="text" id="idnewpoli" value="namepoli">

    </div>

    <div id="idbarrabaja">
      
      <button id="idbtmenupoligono" onclick="fmenupoligono()">&#9859;<div>&#9776;</div></button>
    </div>
    <script>
var vw = window.innerWidth;
var vh = window.innerHeight;
 var savearraaypoli=[];
document.getElementById("idbarrabaja").style.height = String(vh*0.1)+"px";
/*document.getElementById("idbarrabaja").style.width = String(vw)+"px";
document.getElementById("idbarrabaja").style.height = String(vh*0.1)+"px";

document.getElementById("idbarrabaja").style.position = "absolute";
document.getElementById("idbarrabaja").style.top = String(vh*0.77)+"px";
*/
  var marker;
  var poilinea;
  var idxmark=0;
  var midxmarks=[];
  var mmarks=[];
  var ayudaidmark=0;
  var map;
  var cierrap=0;
var ic2="iconf.png";
      var larray=[];
//2.184844, -73.788309
      function initMap() {//2.18775741464856-73.78216861761007
        var myLatLng ={lat:2.18775741464856, lng:-73.78216861761007};


       map = new google.maps.Map(document.getElementById('map'), {
          zoom: 18,
          center: myLatLng,
           mapTypeId: 'satellite',
           draggableCursor:'crosshair'
        });
map.addListener('click',function (e){
mmarks.push(new google.maps.Marker({
          position: e.latLng,
          map: map,
          title: 'dos',
       
          draggable:true,
          icon:"iconf.png",
          idxm:idxmark,
          vecesclik:0
        }));
midxmarks.push({idx:idxmark,marki:mmarks[idxmark]});

if(midxmarks.length===1&&cierrap==0){
mmarks[idxmark].addListener('click',function (e){

  this.setTitle(String(midxmarks[this.idxm].idx));
 this.setLabel("");
crepoligono(savearraaypoli.length,midxmarks);
console.log("xxxx");cierrap=0;
});
}/*else{
mmarks[idxmark].addListener('click',function (e){

  this.setTitle(String(midxmarks[this.idxm].idx));
 this.setLabel("");
});}*/

mmarks[idxmark].addListener('rightclick',function(e){
console.log(midxmarks[this.idxm].marki.idxm);
ayudaidmark=this.idxm;


});

mmarks[idxmark].addListener('dblclick',function(e){
//this.setLabel(String(this.idxm)+"\n"+this.position);

ayudaidmark=this.idxm;
});


idxmark=idxmark+1;


});
       


      }



    function myFunction(){

rhlinea(midxmarks);
    }


    function fdeletmark(){

midxmarks[midxmarks.length-1].marki.setMap(null);
midxmarks.pop();
console.log("elimiado  "+ midxmarks.length);
    }
var flightPlanCoordinates=[];
 var flightPath=[] ;
 var idxflightPath=0;
    function rhlinea(st){
flightPlanCoordinates=[];

      for(var i in st){

flightPlanCoordinates.push(st[i].marki.position);


      }
if(flightPath.length==0){
 flightPath.push({id:idxflightPath,line:new google.maps.Polyline({
          path: flightPlanCoordinates,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2,
          id:idxflightPath
        })});

}

flightPath[idxflightPath].line.setPath(flightPlanCoordinates);

        flightPath[idxflightPath].line.setMap(map);
     flightPath[idxflightPath].line.addListener('dblclick',function(e){

     alert(this.strokeColor);
     });

  if(flightPath.length>0){

  //flightPath[idxflightPath].line.setPath();
//flightPath[flightPath.length].line.setMap(null);
//console.log(flightPath.length);
        }

//flightPath[idxflightPath].line.addListener(,function(e){});

      //  idxflightPath=idxflightPath+1;
    }
    function linesigue (){

     flightPath[idxflightPath].line.setPath(flightPlanCoordinates); 
    }

var arraypolis=[];
var ardatopoli=[];

var namepoli="nn";
var arrtemp=[];
    function crepoligono(idn,ar){
 ardatopoli=[];
  arrtemp=[];
namepoli=document.getElementById("idnewpoli").value;

for(var i in ar){

  ardatopoli.push(ar[i].marki.position);
  arrtemp.push({lat:ar[i].marki.position.lat(),lng:ar[i].marki.position.lng()});
console.log("aa "+ar[i].marki.position.lat());
} //console.log("aa "+savearraaypoli.length);
elimnarmarcasuno(savearraaypoli.length,arrtemp);
      arraypolis.push({id:idn,name:namepoli,poligono: new google.maps.Polygon({ map: map, path: ardatopoli, strokeColor: "#FF0000", strokeOpacity: 0.8, strokeWeight: 2, fillColor: "#FF0000", fillOpacity: 0.35,name:namepoli,idx:savearraaypoli.length-1 })});
      arraypolis[savearraaypoli.length-1].poligono.addListener('click',function(e){

      idxpoligono=this.idx;

mmarks=[];
midxmarks=[];
idxmark=0;
      this.setMap(null);
      console.log("aa "+idxpoligono);
      feditarpolix(savearraaypoli[idxpoligono].datos);
      });

idxsiguepoli=idxsiguepoli+1;

    }


    function elimnarmarcasuno(nm,pathx){
savearraaypoli.push({id:nm,datos:pathx});
      for(var i in midxmarks){
      
        midxmarks[i].marki.setMap(null);
      }
mmarks=[];
midxmarks=[];
idxmark=0;

    }

// variables d epoligono y menus 

var idxpoligono=0;
var idxsiguepoli=0;
//

var vfmenupoligono=1;
function  ocultardiv(st){

document.getElementById(st).style.display = "none";
}
function  mostrardiv(st){

document.getElementById(st).style.display = "block";
}
function fmenupoligono(){
  if(vfmenupoligono==1){
mostrardiv("idmodalmenu");}
else{ocultardiv("idmodalmenu");}

vfmenupoligono=vfmenupoligono+1;
if(vfmenupoligono>=2){vfmenupoligono=0;}
}

ocultardiv("idmodalmenu");


function feditarpolix(ar){

  console.log("llega  "+ar);
for(var i in ar){

  console.log(ar[i].lat);
mmarks.push(new google.maps.Marker({
          position: {lat:ar[i].lat,lng:ar[i].lng},
          map: map,
          title: 'dos',
       
          draggable:true,
          icon:"iconf.png",
          idxm:idxmark,
          vecesclik:0
        }));
midxmarks.push({idx:idxmark,marki:mmarks[idxmark]});

if(midxmarks.length===1&&cierrap==0){
mmarks[idxmark].addListener('click',function (e){

  this.setTitle(String(midxmarks[this.idxm].idx));
 this.setLabel("");
crepoligono(savearraaypoli.length,midxmarks);
console.log("dent");cierrap=0;
});
}/*else{
mmarks[idxmark].addListener('click',function (e){

  this.setTitle(String(midxmarks[this.idxm].idx));
 this.setLabel("");
});}*/

mmarks[idxmark].addListener('rightclick',function(e){
console.log(midxmarks[this.idxm].marki.idxm);
ayudaidmark=this.idxm;


});

mmarks[idxmark].addListener('dblclick',function(e){
//this.setLabel(String(this.idxm)+"\n"+this.position);

ayudaidmark=this.idxm;
});


idxmark=idxmark+1;

}



}



    </script>
    <script async defer
   src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCV4ya46Yoag-iGeJb5SUwZ2q1Irx0UjnU&callback=initMap">
    </script>
  </body>
</html>